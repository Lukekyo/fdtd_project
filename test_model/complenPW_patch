class ComplexPlaneWave:
â€œâ€â€œA 2D plane wave source with intuitive spectrum controlâ€â€â€

```
def __init__(
    self,
    # æ–¹å¼1: å–®ä¸€æ³¢é•· (å–®é »)
    wavelength: float = None,
    
    # æ–¹å¼2: æ³¢é•·ç¯„åœ (å¯¬é »)
    wavelength_min: float = None,
    wavelength_max: float = None,
    
    # æ–¹å¼3: ä¸­å¿ƒæ³¢é•· + è·¨åº¦ (å¯¬é »)
    wavelength_center: float = None,
    wavelength_span: float = None,
    
    # æ–¹å¼4: é »ç‡è¨­å®š
    frequency: float = None,
    frequency_min: float = None,
    frequency_max: float = None,
    
    # å…¶ä»–åƒæ•¸
    amplitude: complex = 1.0 + 0.0j,
    phase_shift: float = 0.0,
    theta_deg: float = 0.0,
    polarization_axis: str = "x",
    name: str = None,
    
    # è„ˆè¡åƒæ•¸ (è‡ªå‹•è¨ˆç®—æˆ–æ‰‹å‹•è¨­å®š)
    auto_pulse_params: bool = True,
    cycle: int = None,
    hanning_dt: float = None,
    medium_n: float = None
):
    """
    å‰µå»ºComplexPlaneWaveï¼Œæ”¯æ´å¤šç¨®é »è­œè¨­å®šæ–¹å¼
    
    è¨­å®šæ–¹å¼ (æ“‡ä¸€ä½¿ç”¨):
    1. wavelength: å–®ä¸€æ³¢é•· â†’ å–®é »é€£çºŒæ³¢
    2. wavelength_min + wavelength_max: æ³¢é•·ç¯„åœ â†’ å¯¬é »è„ˆè¡
    3. wavelength_center + wavelength_span: ä¸­å¿ƒæ³¢é•·+è·¨åº¦ â†’ å¯¬é »è„ˆè¡
    4. frequency, frequency_min, frequency_max: é »ç‡è¨­å®š
    
    Args:
        wavelength: å–®ä¸€æ³¢é•· (m) - ç”¨æ–¼å–®é »
        wavelength_min/max: æ³¢é•·ç¯„åœ (m) - ç”¨æ–¼å¯¬é »
        wavelength_center/span: ä¸­å¿ƒæ³¢é•·å’Œè·¨åº¦ (m) - ç”¨æ–¼å¯¬é »
        auto_pulse_params: æ˜¯å¦è‡ªå‹•è¨ˆç®—è„ˆè¡åƒæ•¸
        cycle: æ‰‹å‹•è¨­å®šè„ˆè¡é€±æœŸæ•¸
        å…¶ä»–åƒæ•¸åŒåŸç‰ˆ
    """
    
    self.amplitude = amplitude
    self.phase_shift = phase_shift
    self.theta_deg = theta_deg
    self.theta = bd.deg2rad(theta_deg)
    self.polarization_axis = polarization_axis.lower()
    self.name = name
    self.n = medium_n if medium_n is not None else 1.0
    
    # è§£æé »è­œè¨­å®š
    self._parse_spectrum_settings(
        wavelength, wavelength_min, wavelength_max,
        wavelength_center, wavelength_span,
        frequency, frequency_min, frequency_max
    )
    
    # è¨­å®šè„ˆè¡åƒæ•¸
    self._setup_pulse_parameters(auto_pulse_params, cycle, hanning_dt)
    
    # åˆå§‹åŒ–å…¶ä»–å±¬æ€§
    self.grid = None
    self.period_sim = None
    self.frequency_sim = None
    self.omega_sim = None
    self.hanning_dt_sim = None
    self.monitoring_enabled = False
    self.monitor_data = {
        'timesteps': [],
        'E_field': [],
        'envelope': [],
        'phase': []
    }

def _parse_spectrum_settings(self, wavelength, wavelength_min, wavelength_max,
                           wavelength_center, wavelength_span,
                           frequency, frequency_min, frequency_max):
    """è§£æä¸¦é©—è­‰é »è­œè¨­å®š"""
    
    # è¨ˆç®—è¨­å®šäº†å¤šå°‘ç¨®æ–¹å¼
    settings_count = sum([
        wavelength is not None,
        all(x is not None for x in [wavelength_min, wavelength_max]),
        all(x is not None for x in [wavelength_center, wavelength_span]),
        frequency is not None,
        all(x is not None for x in [frequency_min, frequency_max])
    ])
    
    if settings_count == 0:
        raise ValueError("å¿…é ˆè¨­å®šé »è­œåƒæ•¸")
    elif settings_count > 1:
        raise ValueError("åªèƒ½ä½¿ç”¨ä¸€ç¨®é »è­œè¨­å®šæ–¹å¼")
    
    # è§£æä¸åŒçš„è¨­å®šæ–¹å¼
    if wavelength is not None:
        # æ–¹å¼1: å–®ä¸€æ³¢é•· â†’ å–®é »
        self.wavelength = wavelength
        self.wavelength_min = wavelength
        self.wavelength_max = wavelength
        self.is_broadband = False
        self.spectrum_type = "monochromatic"
        
    elif wavelength_min is not None and wavelength_max is not None:
        # æ–¹å¼2: æ³¢é•·ç¯„åœ â†’ å¯¬é »
        if wavelength_min >= wavelength_max:
            raise ValueError("wavelength_min å¿…é ˆå°æ–¼ wavelength_max")
        self.wavelength_min = wavelength_min
        self.wavelength_max = wavelength_max
        self.wavelength = (wavelength_min + wavelength_max) / 2  # ä¸­å¿ƒæ³¢é•·
        self.is_broadband = True
        self.spectrum_type = "broadband_range"
        
    elif wavelength_center is not None and wavelength_span is not None:
        # æ–¹å¼3: ä¸­å¿ƒæ³¢é•· + è·¨åº¦ â†’ å¯¬é »
        if wavelength_span <= 0:
            raise ValueError("wavelength_span å¿…é ˆå¤§æ–¼ 0")
        self.wavelength = wavelength_center
        self.wavelength_min = wavelength_center - wavelength_span / 2
        self.wavelength_max = wavelength_center + wavelength_span / 2
        if self.wavelength_min <= 0:
            raise ValueError("wavelength_span éå¤§ï¼Œå°è‡´æœ€å°æ³¢é•· â‰¤ 0")
        self.is_broadband = True
        self.spectrum_type = "broadband_center_span"
        
    elif frequency is not None:
        # æ–¹å¼4: å–®ä¸€é »ç‡ â†’ å–®é »
        self.wavelength = bd.c0 / self.n / frequency
        self.wavelength_min = self.wavelength
        self.wavelength_max = self.wavelength
        self.is_broadband = False
        self.spectrum_type = "monochromatic_freq"
        
    elif frequency_min is not None and frequency_max is not None:
        # æ–¹å¼5: é »ç‡ç¯„åœ â†’ å¯¬é »
        if frequency_min >= frequency_max:
            raise ValueError("frequency_min å¿…é ˆå°æ–¼ frequency_max")
        # æ³¨æ„: é »ç‡ç¯„åœå°æ‡‰çš„æ³¢é•·ç¯„åœæ˜¯åå‘çš„
        self.wavelength_max = bd.c0 / self.n / frequency_min
        self.wavelength_min = bd.c0 / self.n / frequency_max
        self.wavelength = (self.wavelength_min + self.wavelength_max) / 2
        self.is_broadband = True
        self.spectrum_type = "broadband_freq_range"
    
    # è¨ˆç®—é »ç‡åƒæ•¸
    self.frequency = bd.c0 / self.n / self.wavelength  # ä¸­å¿ƒé »ç‡
    self.frequency_min = bd.c0 / self.n / self.wavelength_max
    self.frequency_max = bd.c0 / self.n / self.wavelength_min
    self.period = 1.0 / self.frequency
    self.omega = 2 * bd.pi * self.frequency
    self.k = 2 * np.pi / self.wavelength
    
    # è¨ˆç®—é »è­œå¯¬åº¦
    self.wavelength_bandwidth = self.wavelength_max - self.wavelength_min
    self.frequency_bandwidth = self.frequency_max - self.frequency_min
    self.relative_bandwidth = self.wavelength_bandwidth / self.wavelength

def _setup_pulse_parameters(self, auto_pulse_params, cycle, hanning_dt):
    """è¨­å®šè„ˆè¡åƒæ•¸"""
    
    if self.is_broadband:
        # å¯¬é »å¿…é ˆä½¿ç”¨è„ˆè¡
        self.pulse = True
        
        if auto_pulse_params:
            # è‡ªå‹•è¨ˆç®—æœ€ä½³è„ˆè¡åƒæ•¸
            # è„ˆè¡å¯¬åº¦æ‡‰è©²åŒ…å«è¶³å¤ çš„é€±æœŸä»¥è¦†è“‹é »è­œ
            # ä¸€èˆ¬ä¾†èªªï¼Œcycle = 1/ç›¸å°é »å¯¬ æ˜¯å€‹å¥½çš„èµ·é»
            if self.relative_bandwidth > 0:
                self.cycle = max(3, int(1.0 / self.relative_bandwidth))
            else:
                self.cycle = 5  # é è¨­å€¼
            self.cycle = min(self.cycle, 20)  # é™åˆ¶ä¸Šé™
        else:
            # ä½¿ç”¨æ‰‹å‹•è¨­å®š
            self.cycle = cycle if cycle is not None else 5
        
        self.hanning_dt = hanning_dt  # å¯ä»¥ç‚º Noneï¼Œç¨å¾Œè¨ˆç®—
        
    else:
        # å–®é »å¯ä»¥é¸æ“‡é€£çºŒæ³¢æˆ–è„ˆè¡
        self.pulse = cycle is not None  # å¦‚æœæŒ‡å®šäº† cycle å°±ä½¿ç”¨è„ˆè¡
        self.cycle = cycle if cycle is not None else 5
        self.hanning_dt = hanning_dt

def get_spectrum_info(self):
    """è¿”å›é »è­œè³‡è¨Š"""
    info = {
        'type': self.spectrum_type,
        'is_broadband': self.is_broadband,
        'wavelength_center': self.wavelength,
        'wavelength_min': self.wavelength_min,
        'wavelength_max': self.wavelength_max,
        'wavelength_bandwidth': self.wavelength_bandwidth,
        'frequency_center': self.frequency,
        'frequency_min': self.frequency_min,
        'frequency_max': self.frequency_max,
        'frequency_bandwidth': self.frequency_bandwidth,
        'relative_bandwidth': self.relative_bandwidth,
        'pulse_enabled': self.pulse,
        'pulse_cycles': self.cycle if self.pulse else None
    }
    return info

def print_spectrum_info(self):
    """å°å‡ºé »è­œè³‡è¨Š"""
    info = self.get_spectrum_info()
    print(f"ğŸ“Š å…‰æºé »è­œè³‡è¨Š:")
    print(f"   é¡å‹: {info['type']}")
    print(f"   {'å¯¬é »' if info['is_broadband'] else 'å–®é »'}")
    print(f"   ä¸­å¿ƒæ³¢é•·: {info['wavelength_center']*1e6:.3f} Î¼m")
    
    if info['is_broadband']:
        print(f"   æ³¢é•·ç¯„åœ: {info['wavelength_min']*1e6:.3f} - {info['wavelength_max']*1e6:.3f} Î¼m")
        print(f"   é »å¯¬: {info['wavelength_bandwidth']*1e9:.1f} nm")
        print(f"   ç›¸å°é »å¯¬: {info['relative_bandwidth']*100:.1f}%")
    
    print(f"   ä¸­å¿ƒé »ç‡: {info['frequency_center']/1e12:.2f} THz")
    
    if info['pulse_enabled']:
        print(f"   è„ˆè¡æ¨¡å¼: {info['pulse_cycles']} é€±æœŸ")
    else:
        print(f"   é€£çºŒæ³¢æ¨¡å¼")
```

# ä½¿ç”¨ç¯„ä¾‹

def create_light_source_examples():
â€œâ€â€œå±•ç¤ºä¸åŒçš„å…‰æºå‰µå»ºæ–¹å¼â€â€â€

```
print("=== å…‰æºå‰µå»ºç¯„ä¾‹ ===\n")

# ç¯„ä¾‹1: å–®é »é€£çºŒæ³¢
print("1. å–®é »é€£çºŒæ³¢ (1550nm):")
source1 = ComplexPlaneWave(wavelength=1550e-9)
source1.print_spectrum_info()
print()

# ç¯„ä¾‹2: å¯¬é »è„ˆè¡ (æ³¢é•·ç¯„åœ)
print("2. å¯¬é »è„ˆè¡ (1500-1600nm):")
source2 = ComplexPlaneWave(wavelength_min=1500e-9, wavelength_max=1600e-9)
source2.print_spectrum_info()
print()

# ç¯„ä¾‹3: å¯¬é »è„ˆè¡ (ä¸­å¿ƒ+è·¨åº¦)
print("3. å¯¬é »è„ˆè¡ (ä¸­å¿ƒ1550nm, è·¨åº¦100nm):")
source3 = ComplexPlaneWave(wavelength_center=1550e-9, wavelength_span=100e-9)
source3.print_spectrum_info()
print()

# ç¯„ä¾‹4: é »ç‡è¨­å®š
print("4. é »ç‡è¨­å®š (200-400 THz):")
source4 = ComplexPlaneWave(frequency_min=200e12, frequency_max=400e12)
source4.print_spectrum_info()
print()

# ç¯„ä¾‹5: æ‰‹å‹•è„ˆè¡åƒæ•¸
print("5. æ‰‹å‹•è„ˆè¡åƒæ•¸:")
source5 = ComplexPlaneWave(
    wavelength_center=1550e-9, 
    wavelength_span=50e-9,
    auto_pulse_params=False,
    cycle=10
)
source5.print_spectrum_info()
```

if **name** == â€œ**main**â€:
create_light_source_examples()