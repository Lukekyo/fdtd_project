class ComplexPlaneWave:
â€œâ€â€œA 2D plane wave source with Lumerical-style spectrum controlâ€â€â€

```
def __init__(
    self,
    # ä¸»è¦åƒæ•¸ - æ¨¡ä»¿ Lumerical çš„ä»‹é¢
    wavelength_min: float,
    wavelength_max: float,
    
    # å…¶ä»–åƒæ•¸
    amplitude: complex = 1.0 + 0.0j,
    phase_shift: float = 0.0,
    theta_deg: float = 0.0,
    polarization_axis: str = "x",
    name: str = None,
    
    # é€²éšé¸é … (ä¸€èˆ¬ä¸éœ€è¦æ‰‹å‹•è¨­å®š)
    auto_pulse_params: bool = True,
    manual_cycle: int = None,
    hanning_dt: float = None,
    medium_n: float = None
):
    """
    å‰µå»ºComplexPlaneWaveï¼Œæ¨¡ä»¿ Lumerical çš„ç›´è§€ä»‹é¢
    
    Args:
        wavelength_min: æœ€å°æ³¢é•· (m)
        wavelength_max: æœ€å¤§æ³¢é•· (m)
        
    æ³¨æ„ï¼š
        - ç•¶ wavelength_min == wavelength_max æ™‚ â†’ å–®é »é€£çºŒæ³¢
        - ç•¶ wavelength_min != wavelength_max æ™‚ â†’ å¯¬é »è„ˆè¡
    """
    
    # é©—è­‰è¼¸å…¥
    if wavelength_min <= 0 or wavelength_max <= 0:
        raise ValueError("æ³¢é•·å¿…é ˆå¤§æ–¼ 0")
    if wavelength_min > wavelength_max:
        raise ValueError("wavelength_min ä¸èƒ½å¤§æ–¼ wavelength_max")
    
    # åŸºæœ¬åƒæ•¸
    self.wavelength_min = wavelength_min
    self.wavelength_max = wavelength_max
    self.wavelength_center = (wavelength_min + wavelength_max) / 2
    self.wavelength_span = wavelength_max - wavelength_min
    
    self.amplitude = amplitude
    self.phase_shift = phase_shift
    self.theta_deg = theta_deg
    self.theta = bd.deg2rad(theta_deg)
    self.polarization_axis = polarization_axis.lower()
    self.name = name
    self.n = medium_n if medium_n is not None else 1.0
    
    # è‡ªå‹•åˆ¤æ–·å–®é »/å¯¬é »
    tolerance = 1e-12  # æµ®é»æ•¸æ¯”è¼ƒå®¹å·®
    self.is_monochromatic = abs(wavelength_max - wavelength_min) < tolerance
    
    if self.is_monochromatic:
        # å–®é »æ¨¡å¼ - ä½¿ç”¨é€£çºŒæ³¢
        self.source_type = "monochromatic_cw"
        self.pulse = False
        self.wavelength = wavelength_min  # min = max
        
    else:
        # å¯¬é »æ¨¡å¼ - ä½¿ç”¨è„ˆè¡
        self.source_type = "broadband_pulse"
        self.pulse = True
        self.wavelength = self.wavelength_center
        
        # è‡ªå‹•è¨ˆç®—è„ˆè¡åƒæ•¸
        if auto_pulse_params and manual_cycle is None:
            relative_bandwidth = self.wavelength_span / self.wavelength_center
            # cycle æ•¸èˆ‡ç›¸å°é »å¯¬æˆåæ¯”ï¼Œç¢ºä¿é »è­œè¦†è“‹
            self.cycle = max(3, min(20, int(2.0 / relative_bandwidth)))
        else:
            self.cycle = manual_cycle if manual_cycle is not None else 5
    
    # è¨ˆç®—é »ç‡åƒæ•¸
    self.frequency_center = bd.c0 / self.n / self.wavelength_center
    self.frequency_min = bd.c0 / self.n / wavelength_max  # æ³¨æ„åå‘
    self.frequency_max = bd.c0 / self.n / wavelength_min  # æ³¨æ„åå‘
    self.frequency = self.frequency_center
    
    self.period = 1.0 / self.frequency
    self.omega = 2 * bd.pi * self.frequency
    self.k = 2 * np.pi / self.wavelength
    
    # è¨ˆç®—é »è­œç‰¹æ€§
    self.frequency_bandwidth = self.frequency_max - self.frequency_min
    self.relative_bandwidth = self.wavelength_span / self.wavelength_center
    
    # å…¶ä»–è¨­å®š
    self.hanning_dt = hanning_dt
    
    # åˆå§‹åŒ–å…¶ä»–å±¬æ€§
    self.grid = None
    self.period_sim = None
    self.frequency_sim = None
    self.omega_sim = None
    self.hanning_dt_sim = None
    self.monitoring_enabled = False
    self.monitor_data = {
        'timesteps': [],
        'E_field': [],
        'envelope': [],
        'phase': []
    }

@classmethod
def monochromatic(cls, wavelength: float, **kwargs):
    """ä¾¿æ·æ–¹æ³•ï¼šå‰µå»ºå–®é »å…‰æº"""
    return cls(wavelength_min=wavelength, wavelength_max=wavelength, **kwargs)

@classmethod
def broadband_range(cls, wavelength_min: float, wavelength_max: float, **kwargs):
    """ä¾¿æ·æ–¹æ³•ï¼šå‰µå»ºå¯¬é »å…‰æº (ç¯„åœ)"""
    return cls(wavelength_min=wavelength_min, wavelength_max=wavelength_max, **kwargs)

@classmethod
def broadband_center_span(cls, wavelength_center: float, wavelength_span: float, **kwargs):
    """ä¾¿æ·æ–¹æ³•ï¼šå‰µå»ºå¯¬é »å…‰æº (ä¸­å¿ƒ+è·¨åº¦)"""
    wavelength_min = wavelength_center - wavelength_span / 2
    wavelength_max = wavelength_center + wavelength_span / 2
    return cls(wavelength_min=wavelength_min, wavelength_max=wavelength_max, **kwargs)

def get_spectrum_info(self):
    """è¿”å›é »è­œè³‡è¨Š"""
    return {
        'source_type': self.source_type,
        'is_monochromatic': self.is_monochromatic,
        'wavelength_min_nm': self.wavelength_min * 1e9,
        'wavelength_max_nm': self.wavelength_max * 1e9,
        'wavelength_center_nm': self.wavelength_center * 1e9,
        'wavelength_span_nm': self.wavelength_span * 1e9,
        'frequency_center_THz': self.frequency_center / 1e12,
        'frequency_bandwidth_THz': self.frequency_bandwidth / 1e12,
        'relative_bandwidth_percent': self.relative_bandwidth * 100,
        'pulse_enabled': self.pulse,
        'pulse_cycles': self.cycle if self.pulse else None
    }

def print_spectrum_info(self):
    """åˆ—å°é »è­œè³‡è¨Šï¼Œæ¨¡ä»¿ Lumerical çš„é¡¯ç¤ºé¢¨æ ¼"""
    info = self.get_spectrum_info()
    
    print(f"ğŸ“Š Source: {self.name or 'ComplexPlaneWave'}")
    print(f"   Type: {'Monochromatic' if info['is_monochromatic'] else 'Broadband'}")
    
    if info['is_monochromatic']:
        print(f"   Wavelength: {info['wavelength_center_nm']:.1f} nm")
        print(f"   Mode: Continuous Wave (CW)")
    else:
        print(f"   Wavelength range: {info['wavelength_min_nm']:.1f} - {info['wavelength_max_nm']:.1f} nm")
        print(f"   Center wavelength: {info['wavelength_center_nm']:.1f} nm")
        print(f"   Bandwidth: {info['wavelength_span_nm']:.1f} nm ({info['relative_bandwidth_percent']:.1f}%)")
        print(f"   Mode: Pulsed ({info['pulse_cycles']} cycles)")
    
    print(f"   Frequency: {info['frequency_center_THz']:.2f} THz")
    
    if not info['is_monochromatic']:
        print(f"   Frequency bandwidth: {info['frequency_bandwidth_THz']:.2f} THz")

def _register_grid(self, grid, x, y, z):
    """è¨»å†Šåˆ°ç¶²æ ¼çš„æ–¹æ³• (åŸæœ‰çš„é‚è¼¯)"""
    # é€™è£¡ä¿æŒåŸæœ‰çš„ç¶²æ ¼è¨»å†Šé‚è¼¯
    # ...
    pass

def update_E(self):
    """æ›´æ–°é›»å ´çš„æ–¹æ³• (åŸæœ‰çš„é‚è¼¯)"""
    # é€™è£¡ä¿æŒåŸæœ‰çš„é›»å ´æ›´æ–°é‚è¼¯
    # ...
    pass
```

# ä½¿ç”¨ç¯„ä¾‹

def demonstrate_lumerical_style():
â€œâ€â€œå±•ç¤º Lumerical é¢¨æ ¼çš„ä½¿ç”¨æ–¹å¼â€â€â€

```
print("=== Lumerical é¢¨æ ¼çš„å…‰æºè¨­å®š ===\n")

# æ–¹å¼1: åƒ Lumerical ä¸€æ¨£è¨­å®šå–®é » (min = max)
print("1. å–®é »å…‰æº (æ¨¡ä»¿ Lumerical min=max è¨­å®š):")
source1 = ComplexPlaneWave(wavelength_min=1550e-9, wavelength_max=1550e-9)
source1.print_spectrum_info()
print()

# æ–¹å¼2: åƒ Lumerical ä¸€æ¨£è¨­å®šå¯¬é » (min â‰  max)
print("2. å¯¬é »å…‰æº (æ¨¡ä»¿ Lumerical minâ‰ max è¨­å®š):")
source2 = ComplexPlaneWave(wavelength_min=1500e-9, wavelength_max=1600e-9)
source2.print_spectrum_info()
print()

# æ–¹å¼3: ä¾¿æ·æ–¹æ³•
print("3. ä¾¿æ·æ–¹æ³•:")
source3a = ComplexPlaneWave.monochromatic(wavelength=1550e-9)
source3b = ComplexPlaneWave.broadband_center_span(
    wavelength_center=1550e-9, 
    wavelength_span=100e-9
)

print("å–®é »ä¾¿æ·æ–¹æ³•:")
source3a.print_spectrum_info()
print()

print("å¯¬é »ä¾¿æ·æ–¹æ³•:")
source3b.print_spectrum_info()
```

if **name** == â€œ**main**â€:
demonstrate_lumerical_style()