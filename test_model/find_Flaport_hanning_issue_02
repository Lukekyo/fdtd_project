<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨™æº–Python Hanningå‡½æ•¸å°æ¯”</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .chart-container {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .code-box {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
        }
        .comparison-box {
            background: #fff3cd;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #ffc107;
            border-radius: 5px;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .full-width {
            grid-column: 1 / -1;
        }
        h2 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .highlight {
            background: #ffeb3b;
            padding: 2px 4px;
            border-radius: 3px;
        }
        .error {
            background: #ffebee;
            border-left: 4px solid #f44336;
        }
        .correct {
            background: #e8f5e8;
            border-left: 4px solid #4caf50;
        }
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>æ¨™æº–Python Hanningå‡½æ•¸å°æ¯”</h1>
        
        <h2>1. æ¨™æº–Pythonåº«ä¸­çš„Hanningçª—</h2>
        
        <div class="grid">
            <div>
                <h3>NumPy / SciPyå¯¦ç¾</h3>
                <div class="code-box">
<span style="color: #68d391"># NumPy</span>
import numpy as np

<span style="color: #fbb6ce"># æ–¹æ³•1ï¼šç›´æ¥ç”Ÿæˆçª—</span>
window = np.hanning(N)  <span style="color: #a0aec0"># Nå€‹é»çš„çª—</span>

<span style="color: #fbb6ce"># æ–¹æ³•2ï¼šæ‰‹å‹•è¨ˆç®—</span>
n = np.arange(N)
window = 0.5 * (1 - np.cos(2*np.pi*n/(N-1)))

<span style="color: #fbb6ce"># æ‡‰ç”¨åˆ°ä¿¡è™Ÿ</span>
signal_windowed = signal * window
                </div>
            </div>
            
            <div>
                <h3>æ¨™æº–Hanningçª—ç‰¹æ€§</h3>
                <div class="comparison-box correct">
                    <strong>âœ… æ­£ç¢ºç‰¹æ€§ï¼š</strong><br>
                    â€¢ <strong>ç´”åŒ…çµ¡</strong>ï¼šåªæ˜¯çª—å‡½æ•¸ï¼Œä¸åŒ…å«è¼‰æ³¢<br>
                    â€¢ <strong>ç¯„åœ</strong>ï¼šå€¼åœ¨[0, 1]ä¹‹é–“<br>
                    â€¢ <strong>å°ç¨±</strong>ï¼šé—œæ–¼ä¸­å¿ƒé»å°ç¨±<br>
                    â€¢ <strong>é‚Šç•Œ</strong>ï¼šå…©ç«¯ç‚º0ï¼Œä¸­å¿ƒç‚º1<br>
                    â€¢ <strong>å¹³æ»‘</strong>ï¼šé€£çºŒä¸”å¯å¾®
                </div>
            </div>
        </div>

        <div class="chart-container">
            <h3>æ¨™æº–Hanningçª—å¯è¦–åŒ–</h3>
            <canvas id="standardHanning" width="800" height="400"></canvas>
        </div>

        <h2>2. Flaportçš„Hanningå‡½æ•¸</h2>
        
        <div class="code-box">
<span style="color: #68d391"># Flaportçš„å¯¦ç¾</span>
def hanning(f, t, n):
    return (1 / 2) * (1 - cos(f * t / n)) * (sin(f * t))
    <span style="color: #f56565">       ^^^åŒ…çµ¡éƒ¨åˆ†^^^       ^^^è¼‰æ³¢éƒ¨åˆ†^^^</span>
        </div>
        
        <div class="comparison-box error">
            <strong>âŒ å•é¡Œï¼š</strong><br>
            é€™<strong>ä¸æ˜¯</strong>æ¨™æº–çš„Hanningçª—ï¼é€™æ˜¯ä¸€å€‹<strong>èª¿åˆ¶ä¿¡è™Ÿ</strong>ï¼ŒåŒæ™‚åŒ…å«äº†åŒ…çµ¡å’Œè¼‰æ³¢ã€‚
        </div>

        <h2>3. å…©è€…å°æ¯”</h2>
        
        <div class="chart-container full-width">
            <h3>æ¨™æº–Hanning vs Flaport Hanning</h3>
            <canvas id="hanningComparison" width="1000" height="500"></canvas>
        </div>

        <h2>4. æ­£ç¢ºçš„FDTDè„ˆè¡å¯¦ç¾</h2>
        
        <div class="grid">
            <div>
                <h3>æ–¹æ³•1ï¼šæ¨™æº–çª—å‡½æ•¸ + è¼‰æ³¢</h3>
                <div class="code-box">
<span style="color: #68d391"># æ­£ç¢ºçš„åˆ†é›¢å¼è¨­è¨ˆ</span>
def create_pulse(timesteps, pulse_length, frequency):
    <span style="color: #fbb6ce"># 1. å‰µå»ºçª—å‡½æ•¸</span>
    window = np.hanning(pulse_length)
    
    <span style="color: #fbb6ce"># 2. å‰µå»ºè¼‰æ³¢</span>
    t = np.arange(timesteps)
    carrier = np.sin(2 * np.pi * frequency * t)
    
    <span style="color: #fbb6ce"># 3. æ‡‰ç”¨çª—åˆ°æŒ‡å®šå€é–“</span>
    pulse = carrier.copy()
    start_idx = (timesteps - pulse_length) // 2
    end_idx = start_idx + pulse_length
    pulse[start_idx:end_idx] *= window
    pulse[:start_idx] = 0
    pulse[end_idx:] = 0
    
    return pulse
                </div>
            </div>
            
            <div>
                <h3>æ–¹æ³•2ï¼šå³æ™‚è¨ˆç®—ï¼ˆæ¨è–¦ï¼‰</h3>
                <div class="code-box">
<span style="color: #68d391"># é©åˆFDTDçš„å³æ™‚è¨ˆç®—</span>
def get_pulse_amplitude(q, pulse_start, pulse_length):
    if pulse_start <= q < pulse_start + pulse_length:
        <span style="color: #fbb6ce"># åœ¨è„ˆè¡å…§ï¼Œè¨ˆç®—çª—å‡½æ•¸å€¼</span>
        relative_pos = (q - pulse_start) / pulse_length
        window_value = 0.5 * (1 - np.cos(2*np.pi*relative_pos))
        return window_value
    else:
        return 0.0

<span style="color: #fbb6ce"># åœ¨FDTDå¾ªç’°ä¸­ä½¿ç”¨</span>
for q in range(total_timesteps):
    envelope = get_pulse_amplitude(q, start, length)
    carrier_phase = omega * q
    field = amplitude * envelope * np.exp(1j * carrier_phase)
                </div>
            </div>
        </div>

        <div class="chart-container full-width">
            <h3>æ­£ç¢ºçš„è„ˆè¡å¯¦ç¾å°æ¯”</h3>
            <canvas id="correctImplementation" width="1000" height="400"></canvas>
        </div>

        <h2>5. æ‚¨çš„ä¿®æ­£å»ºè­°</h2>
        
        <div class="comparison-box correct">
            <h3>ğŸ¯ æ¨è–¦è§£æ±ºæ–¹æ¡ˆ</h3>
            <p><strong>æ›¿æ›Flaportçš„hanningå‡½æ•¸ï¼š</strong></p>
        </div>
        
        <div class="code-box">
<span style="color: #68d391"># ä¿®æ­£å¾Œçš„åŒ…çµ¡å‡½æ•¸</span>
def hanning_envelope(pulse_progress, total_length):
    """
    pulse_progress: ç•¶å‰åœ¨è„ˆè¡ä¸­çš„ä½ç½® (0åˆ°total_length)
    total_length: è„ˆè¡ç¸½é•·åº¦
    """
    if 0 <= pulse_progress <= total_length:
        relative_pos = pulse_progress / total_length
        return 0.5 * (1 - np.cos(2 * np.pi * relative_pos))
    else:
        return 0.0

<span style="color: #68d391"># åœ¨ComplexPlaneWaveä¸­ä½¿ç”¨</span>
def update_E(self):
    q = self.grid.time_steps_passed
    
    if self.pulse:
        pulse_duration = self.cycle * self.period_sim
        if q < pulse_duration:
            envelope = hanning_envelope(q, pulse_duration)
        else:
            envelope = 0
    else:
        envelope = 1
    
    <span style="color: #fbb6ce"># è¼‰æ³¢ç”±ä¸»ç›¸ä½æ§åˆ¶</span>
    time_phase = self.omega_sim * q + self.phase_shift
    
    for xi, zi in zip(self.x, self.z):
        spatial_phase = self.spatial_phase[(xi, zi)]
        total_phase = time_phase + spatial_phase
        field_value = self.amplitude * envelope * bd.exp(1j * total_phase)
        self.grid.E[xi, 0, zi, self.pol_index] += field_value
        </div>

        <div class="comparison-box">
            <strong>é—œéµæ”¹é€²ï¼š</strong><br>
            âœ… åŒ…çµ¡å’Œè¼‰æ³¢å®Œå…¨åˆ†é›¢<br>
            âœ… è¼‰æ³¢é »ç‡ç”±omega_simçµ±ä¸€æ§åˆ¶<br>
            âœ… çª—å‡½æ•¸åªè² è²¬èª¿åˆ¶æŒ¯å¹…<br>
            âœ… é¿å…é »ç‡è¡çªå•é¡Œ
        </div>
    </div>

    <script>
        // ç”Ÿæˆæ¨™æº–Hanningçª—
        const N = 100;
        const indices = Array.from({length: N}, (_, i) => i);
        const standardHanning = indices.map(i => 0.5 * (1 - Math.cos(2 * Math.PI * i / (N - 1))));
        
        // æ¨¡æ“¬Flaportåƒæ•¸
        const f = 0.1;
        const n = 5;
        const t_values = Array.from({length: 200}, (_, i) => i);
        
        // Flaport hanningå‡½æ•¸
        const flopartHanning = t_values.map(t => {
            const envelope = 0.5 * (1 - Math.cos(f * t / n));
            const carrier = Math.sin(f * t);
            return envelope * carrier;
        });
        
        // Flaportçš„åŒ…çµ¡éƒ¨åˆ†
        const flopartEnvelope = t_values.map(t => 0.5 * (1 - Math.cos(f * t / n)));
        
        // Flaportçš„è¼‰æ³¢éƒ¨åˆ†
        const flopartCarrier = t_values.map(t => Math.sin(f * t));

        // åœ–è¡¨é…ç½®
        const chartConfig = {
            type: 'line',
            options: {
                responsive: true,
                elements: { point: { radius: 0 } },
                plugins: { legend: { display: true } },
                scales: {
                    x: { title: { display: true } },
                    y: { title: { display: true } }
                }
            }
        };
        
        // 1. æ¨™æº–Hanningçª—
        new Chart(document.getElementById('standardHanning'), {
            ...chartConfig,
            data: {
                labels: indices,
                datasets: [{
                    label: 'æ¨™æº–Hanningçª—ï¼š0.5 Ã— (1 - cos(2Ï€n/(N-1)))',
                    data: standardHanning,
                    borderColor: '#2196F3',
                    borderWidth: 3,
                    backgroundColor: 'rgba(33, 150, 243, 0.1)',
                    fill: true
                }]
            },
            options: {
                ...chartConfig.options,
                scales: {
                    x: { title: { display: true, text: 'æ¨£æœ¬ç´¢å¼•' } },
                    y: { title: { display: true, text: 'çª—å€¼ [0, 1]' } }
                }
            }
        });
        
        // 2. Hanningå°æ¯”
        new Chart(document.getElementById('hanningComparison'), {
            ...chartConfig,
            data: {
                labels: t_values,
                datasets: [
                    {
                        label: 'FlaportåŒ…çµ¡ï¼š(1 - cos(fÃ—t/n))',
                        data: flopartEnvelope,
                        borderColor: '#FF9800',
                        borderWidth: 3,
                        fill: false
                    },
                    {
                        label: 'Flaportè¼‰æ³¢ï¼šsin(fÃ—t)',
                        data: flopartCarrier.map(x => x * 0.5), // ç¸®æ”¾ä¾¿æ–¼è§€çœ‹
                        borderColor: '#F44336',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        fill: false
                    },
                    {
                        label: 'Flaportå®Œæ•´ï¼šåŒ…çµ¡ Ã— è¼‰æ³¢',
                        data: flopartHanning,
                        borderColor: '#9C27B0',
                        borderWidth: 2,
                        fill: false
                    }
                ]
            },
            options: {
                ...chartConfig.options,
                scales: {
                    x: { title: { display: true, text: 'æ™‚é–“åƒæ•¸ t' } },
                    y: { title: { display: true, text: 'æŒ¯å¹…' } }
                }
            }
        });
        
        // 3. æ­£ç¢ºå¯¦ç¾å°æ¯”
        const totalTime = 200;
        const pulseStart = 50;
        const pulseLength = 50;
        const carrierFreq = 0.2;
        
        const timeAxis = Array.from({length: totalTime}, (_, i) => i);
        
        // éŒ¯èª¤çš„æ–¹æ³•ï¼ˆFlaport styleï¼‰
        const wrongPulse = timeAxis.map(t => {
            if (t >= pulseStart && t < pulseStart + pulseLength) {
                const relT = t - pulseStart;
                const envelope = 0.5 * (1 - Math.cos(f * relT / n));
                const wrongCarrier = Math.sin(f * relT);
                const mainCarrier = Math.sin(carrierFreq * t);
                return envelope * wrongCarrier * mainCarrier; // é »ç‡è¡çªï¼
            }
            return 0;
        });
        
        // æ­£ç¢ºçš„æ–¹æ³•
        const correctPulse = timeAxis.map(t => {
            let envelope = 0;
            if (t >= pulseStart && t < pulseStart + pulseLength) {
                const progress = (t - pulseStart) / pulseLength;
                envelope = 0.5 * (1 - Math.cos(2 * Math.PI * progress));
            }
            const carrier = Math.sin(carrierFreq * t);
            return envelope * carrier;
        });
        
        // åªæœ‰åŒ…çµ¡
        const envelopeOnly = timeAxis.map(t => {
            if (t >= pulseStart && t < pulseStart + pulseLength) {
                const progress = (t - pulseStart) / pulseLength;
                return 0.5 * (1 - Math.cos(2 * Math.PI * progress));
            }
            return 0;
        });
        
        new Chart(document.getElementById('correctImplementation'), {
            ...chartConfig,
            data: {
                labels: timeAxis,
                datasets: [
                    {
                        label: 'ç´”åŒ…çµ¡ï¼ˆæ¨™æº–Hanningï¼‰',
                        data: envelopeOnly,
                        borderColor: '#4CAF50',
                        borderWidth: 3,
                        backgroundColor: 'rgba(76, 175, 80, 0.2)',
                        fill: true
                    },
                    {
                        label: 'æ­£ç¢ºçš„è„ˆè¡ï¼šåŒ…çµ¡ Ã— çµ±ä¸€è¼‰æ³¢',
                        data: correctPulse,
                        borderColor: '#2196F3',
                        borderWidth: 2,
                        fill: false
                    },
                    {
                        label: 'éŒ¯èª¤çš„è„ˆè¡ï¼šé »ç‡è¡çª',
                        data: wrongPulse,
                        borderColor: '#F44336',
                        borderWidth: 2,
                        borderDash: [3, 3],
                        fill: false
                    }
                ]
            },
            options: {
                ...chartConfig.options,
                scales: {
                    x: { title: { display: true, text: 'æ™‚é–“ (timesteps)' } },
                    y: { title: { display: true, text: 'å ´æŒ¯å¹…' } }
                }
            }
        });
    </script>
</body>
</html>
