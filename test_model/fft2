<!DOCTYPE html>

<html>
<head>
    <meta charset="UTF-8">
    <title>Pulse FFTåŸºç¤æ¦‚å¿µ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .section { background: white; margin: 20px 0; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .chart-container { width: 100%; height: 300px; margin: 20px 0; }
        .comparison { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .highlight { background: #e3f2fd; padding: 15px; border-left: 4px solid #2196f3; margin: 10px 0; }
        .problem { background: #ffebee; padding: 15px; border-left: 4px solid #f44336; margin: 10px 0; }
        .solution { background: #e8f5e8; padding: 15px; border-left: 4px solid #4caf50; margin: 10px 0; }
        .warning { background: #fff3e0; padding: 15px; border-left: 4px solid #ff9800; margin: 10px 0; }
        h2 { color: #1976d2; border-bottom: 2px solid #e0e0e0; padding-bottom: 10px; }
        h3 { color: #424242; }
        .formula { background: #f8f9fa; padding: 10px; border-radius: 5px; font-family: monospace; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ Pulse FFT åŸºç¤æ¦‚å¿µå…¨è§£æ</h1>

```
    <!-- å•é¡Œ1ï¼šå–®é »vså¯¬é » -->
    <div class="section">
        <h2>1. å–®é »å…‰ vs å¯¬é »å…‰ï¼šæ™‚é–“è¶ŠçŸ­ï¼Œé »å¯¬è¶Šå¯¬ï¼</h2>
        
        <div class="highlight">
            <strong>ğŸ”‘ é—œéµæ¦‚å¿µï¼šä¸ç¢ºå®šæ€§åŸç†</strong><br>
            <div class="formula">Î”t Ã— Î”Ï‰ â‰¥ 1/2</div>
            <p><strong>æ„æ€</strong>ï¼šæ™‚é–“è¶ŠçŸ­çš„pulseï¼ŒåŒ…å«çš„é »ç‡ç¯„åœè¶Šå¯¬ï¼</p>
        </div>

        <div class="comparison">
            <div>
                <h3>ğŸ“» é•·è„ˆè¡ï¼ˆæ¥è¿‘å–®é »ï¼‰</h3>
                <div class="chart-container">
                    <canvas id="longPulseChart"></canvas>
                </div>
                <div class="solution">
                    âœ… å¾ˆå¤šå€‹æ³¢é•· â†’ æ¥è¿‘å–®é »<br>
                    âœ… FFTå¾Œæœƒæ˜¯çª„å³°
                </div>
            </div>
            
            <div>
                <h3>âš¡ çŸ­è„ˆè¡ï¼ˆå¯¬é »ï¼‰</h3>
                <div class="chart-container">
                    <canvas id="shortPulseChart"></canvas>
                </div>
                <div class="warning">
                    âš ï¸ åªæœ‰1-2å€‹æ³¢é•· â†’ å¯¬é »<br>
                    âš ï¸ FFTå¾Œæœƒæ˜¯å¯¬å³°
                </div>
            </div>
        </div>

        <div class="highlight">
            <strong>å›ç­”æ‚¨çš„å•é¡Œ</strong>ï¼š
            <ul>
                <li>ğŸ“Š <strong>"åªæœ‰ä¸€å€‹æ³¢é•·"</strong> â†’ FFTæœƒå¾—åˆ°å¾ˆå¯¬çš„é »è­œï¼Œä¸æ˜¯ä¸€å€‹é»ï¼</li>
                <li>ğŸ¯ <strong>åˆ¤æ–·æ–¹æ³•</strong>ï¼šçœ‹æ‚¨çš„pulseåŒ…å«å¹¾å€‹æŒ¯ç›ªé€±æœŸ</li>
                <li>ğŸ“ <strong>ç¶“é©—æ³•å‰‡</strong>ï¼š>10å€‹é€±æœŸ â‰ˆ æº–å–®é »ï¼Œ<5å€‹é€±æœŸ = å¯¬é »</li>
            </ul>
        </div>
    </div>

    <!-- å•é¡Œ2ï¼šè¨˜éŒ„æ™‚é–“é•·åº¦ -->
    <div class="section">
        <h2>2. ç‚ºä»€éº¼è¦è®“æ•´å€‹Pulseç©¿éï¼Ÿæ™‚é–“è¶Šé•·è¶Šå¥½å—ï¼Ÿ</h2>
        
        <div class="chart-container">
            <canvas id="recordingTimeChart"></canvas>
        </div>

        <div class="highlight">
            <strong>ğŸ¯ è¨˜éŒ„æ™‚é–“çš„è€ƒé‡</strong>ï¼š
            <ol>
                <li><strong>å®Œæ•´æ€§</strong>ï¼šå¿…é ˆè¨˜éŒ„å®Œæ•´çš„pulseï¼Œå¦å‰‡æœƒæœ‰truncationèª¤å·®</li>
                <li><strong>é »ç‡è§£æåº¦</strong>ï¼šÎ”f = 1/Tï¼Œè¨˜éŒ„æ™‚é–“Tè¶Šé•·ï¼Œé »ç‡è§£æåº¦è¶Šå¥½</li>
                <li><strong>ç©©å®šæ€§</strong>ï¼šlonger â‰  betterï¼Œå¤ªé•·æœƒå¼•å…¥é›œè¨Š</li>
            </ol>
        </div>

        <div class="warning">
            <strong>âš ï¸ æœ€ä½³è¨˜éŒ„æ™‚é–“</strong>ï¼š
            <ul>
                <li>ğŸ“ <strong>æœ€çŸ­</strong>ï¼špulseå®Œå…¨é€šé + ä¸€äº›bufferæ™‚é–“</li>
                <li>ğŸ“ <strong>æœ€é•·</strong>ï¼šé¿å…é•·æ™‚é–“çš„æ•¸å€¼é›œè¨Šç´¯ç©</li>
                <li>ğŸ¯ <strong>å¯¦ç”¨å»ºè­°</strong>ï¼špulse_duration Ã— 2~3å€</li>
            </ul>
        </div>

        <div class="formula">
            æœ€ä½³è¨˜éŒ„æ™‚é–“ â‰ˆ pulse_width + 2Ã—(çµæ§‹é€šéæ™‚é–“) + buffer
        </div>
    </div>

    <!-- å•é¡Œ3ï¼šFFT vs DFT -->
    <div class="section">
        <h2>3. FFT vs DFTï¼šé€Ÿåº¦çš„å·®åˆ¥</h2>
        
        <div class="comparison">
            <div>
                <h3>ğŸŒ DFT (Discrete Fourier Transform)</h3>
                <div class="formula">
                    X(k) = Î£ x(n) Ã— e^(-j2Ï€kn/N)<br>
                    è¨ˆç®—è¤‡é›œåº¦ï¼šO(NÂ²)
                </div>
                <div class="problem">
                    âŒ å°æ¯å€‹é »ç‡éƒ½è¦è¨ˆç®—Næ¬¡<br>
                    âŒ N=1024æ™‚éœ€è¦ ~1M æ¬¡é‹ç®—
                </div>
            </div>
            
            <div>
                <h3>ğŸš€ FFT (Fast Fourier Transform)</h3>
                <div class="formula">
                    ä½¿ç”¨åˆ†æ²»æ³•åŠ é€ŸDFT<br>
                    è¨ˆç®—è¤‡é›œåº¦ï¼šO(N log N)
                </div>
                <div class="solution">
                    âœ… è°æ˜çš„ç®—æ³•ï¼Œé‡è¤‡åˆ©ç”¨è¨ˆç®—<br>
                    âœ… N=1024æ™‚åªéœ€è¦ ~10K æ¬¡é‹ç®—
                </div>
            </div>
        </div>

        <div class="chart-container">
            <canvas id="complexityChart"></canvas>
        </div>

        <div class="highlight">
            <strong>çµè«–</strong>ï¼šFFTå’ŒDFTçš„çµæœå®Œå…¨ç›¸åŒï¼Œä½†FFTå¿«å¾ˆå¤šï¼<br>
            ç¾åœ¨æ‰€æœ‰è»Ÿé«”ï¼ˆPython, MATLABç­‰ï¼‰èªªçš„"FFT"å…¶å¯¦å°±æ˜¯å¿«é€Ÿç‰ˆçš„DFTã€‚
        </div>
    </div>

    <!-- å•é¡Œ4ï¼šå…¶ä»–é‡è¦æ¦‚å¿µ -->
    <div class="section">
        <h2>4. å…¶ä»–é‡è¦çš„åŸºç¤æ¦‚å¿µ</h2>
        
        <div class="comparison">
            <div>
                <h3>ğŸ”¢ å–æ¨£å®šç† (Nyquist)</h3>
                <div class="formula">
                    f_sample â‰¥ 2 Ã— f_max
                </div>
                <div class="warning">
                    âš ï¸ æ™‚é–“æ­¥Î”tè¦å¤ å°<br>
                    å¦å‰‡æœƒæœ‰aliasing
                </div>
            </div>
            
            <div>
                <h3>ğŸªŸ è¦–çª—å‡½æ•¸ (Windowing)</h3>
                <div class="formula">
                    æ¸›å°‘é »è­œæ´©æ¼<br>
                    Hanning, Hamming, etc.
                </div>
                <div class="solution">
                    âœ… è®“pulseé‚Šç•Œæ›´smooth<br>
                    âœ… æ¸›å°‘å‡çš„é »ç‡æˆåˆ†
                </div>
            </div>
        </div>

        <h3>ğŸ“š æ‚¨é‚„æ‡‰è©²çŸ¥é“çš„æ¦‚å¿µï¼š</h3>
        <ul>
            <li><strong>ğŸ”„ é€±æœŸæ€§å‡è¨­</strong>ï¼šFFTå‡è¨­ä¿¡è™Ÿæ˜¯é€±æœŸæ€§çš„</li>
            <li><strong>ğŸ“Š åŠŸç‡è­œå¯†åº¦</strong>ï¼š|FFT(x)|Â²æ‰æ˜¯åŠŸç‡</li>
            <li><strong>ğŸ¯ é›¶å¡«è£œ (Zero-padding)</strong>ï¼šå¢åŠ é »ç‡è§£æåº¦çš„æŠ€å·§</li>
            <li><strong>âš¡ æ¼é » (Spectral Leakage)</strong>ï¼šéæ•´æ•¸é€±æœŸé€ æˆçš„å‡é »ç‡</li>
            <li><strong>ğŸ”— ç›¸ä½ä¿¡æ¯</strong>ï¼šFFTåŒ…å«æŒ¯å¹…å’Œç›¸ä½ï¼ŒåŠŸç‡åªçœ‹æŒ¯å¹…</li>
        </ul>

        <div class="solution">
            <strong>ğŸ¯ å¯¦ç”¨å»ºè­°</strong>ï¼š
            <ol>
                <li>å…ˆæª¢æŸ¥æ‚¨çš„pulseåŒ…å«å¹¾å€‹æŒ¯ç›ªé€±æœŸ</li>
                <li>ç¢ºä¿è¨˜éŒ„æ™‚é–“åŒ…å«å®Œæ•´pulse</li>
                <li>æª¢æŸ¥æ™‚é–“æ­¥æ˜¯å¦æ»¿è¶³Nyquistæ¢ä»¶</li>
                <li>è€ƒæ…®åŠ è¦–çª—å‡½æ•¸æ¸›å°‘leakage</li>
                <li>ç”¨|FFT(x)|Â²è¨ˆç®—åŠŸç‡è­œ</li>
            </ol>
        </div>
    </div>

    <!-- å¯¦ç”¨æª¢æŸ¥æ¸…å–® -->
    <div class="section">
        <h2>5. æ‚¨çš„Pulseåˆ†ææª¢æŸ¥æ¸…å–® âœ…</h2>
        
        <div class="highlight">
            <strong>ğŸ” æª¢æŸ¥æ‚¨çš„è¨­ç½®</strong>ï¼š
            <pre style="background: #f0f0f0; padding: 10px; border-radius: 5px;">
```

# 1. æª¢æŸ¥pulseç‰¹æ€§

print(fâ€Pulseé€±æœŸæ•¸: {source.cycle}â€)
print(fâ€PulseæŒçºŒæ™‚é–“: {source.cycle * source.period_sim * grid.time_step:.2e} ç§’â€)

# 2. æª¢æŸ¥æ˜¯å¦å–®é »

if source.cycle > 10:
print(â€œâœ… æ¥è¿‘å–®é »â€)
elif source.cycle > 5:
print(â€œâš ï¸ æº–å–®é »â€)
else:
print(â€œâŒ å¯¬é »pulseâ€)

# 3. æª¢æŸ¥è¨˜éŒ„æ™‚é–“

pulse_duration = source.cycle * source.period_sim
if len(detector.E) > pulse_duration * 3:
print(â€œâœ… è¨˜éŒ„æ™‚é–“å……è¶³â€)
else:
print(â€œâš ï¸ å¯èƒ½éœ€è¦æ›´é•·è¨˜éŒ„æ™‚é–“â€)

# 4. æª¢æŸ¥å–æ¨£

dt = grid.time_step
f_max = 1 / source.period  # ä¼°ç®—æœ€é«˜é »ç‡
if 1/dt > 2 * f_max:
print(â€œâœ… æ»¿è¶³Nyquistæ¢ä»¶â€)
else:
print(â€œâŒ æ™‚é–“æ­¥å¤ªå¤§ï¼Œå¯èƒ½æœ‰aliasingâ€)
</pre>
</div>
</div>
</div>

```
<script>
    // é•·è„ˆè¡åœ–
    const longPulseCtx = document.getElementById('longPulseChart').getContext('2d');
    const longPulseData = [];
    const longPulseLabels = [];
    for (let i = 0; i < 200; i++) {
        const t = i * 0.1;
        longPulseLabels.push(t.toFixed(1));
        // é•·è„ˆè¡ï¼š10å€‹é€±æœŸçš„Gaussian
        const envelope = Math.exp(-Math.pow((t - 10), 2) / 20);
        const carrier = Math.cos(2 * Math.PI * t);
        longPulseData.push(envelope * carrier);
    }

    new Chart(longPulseCtx, {
        type: 'line',
        data: {
            labels: longPulseLabels,
            datasets: [{
                label: 'é•·è„ˆè¡ (10å€‹é€±æœŸ)',
                data: longPulseData,
                borderColor: 'rgb(75, 192, 192)',
                borderWidth: 1,
                pointRadius: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: { title: { display: true, text: 'æ™‚é–“' }},
                y: { title: { display: true, text: 'æŒ¯å¹…' }}
            }
        }
    });

    // çŸ­è„ˆè¡åœ–
    const shortPulseCtx = document.getElementById('shortPulseChart').getContext('2d');
    const shortPulseData = [];
    const shortPulseLabels = [];
    for (let i = 0; i < 200; i++) {
        const t = i * 0.1;
        shortPulseLabels.push(t.toFixed(1));
        // çŸ­è„ˆè¡ï¼š2å€‹é€±æœŸçš„Gaussian
        const envelope = Math.exp(-Math.pow((t - 10), 2) / 4);
        const carrier = Math.cos(2 * Math.PI * t);
        shortPulseData.push(envelope * carrier);
    }

    new Chart(shortPulseCtx, {
        type: 'line',
        data: {
            labels: shortPulseLabels,
            datasets: [{
                label: 'çŸ­è„ˆè¡ (2å€‹é€±æœŸ)',
                data: shortPulseData,
                borderColor: 'rgb(255, 99, 132)',
                borderWidth: 1,
                pointRadius: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: { title: { display: true, text: 'æ™‚é–“' }},
                y: { title: { display: true, text: 'æŒ¯å¹…' }}
            }
        }
    });

    // è¨˜éŒ„æ™‚é–“ç¤ºæ„åœ–
    const recordingCtx = document.getElementById('recordingTimeChart').getContext('2d');
    const recordingData1 = [];
    const recordingData2 = [];
    const recordingData3 = [];
    const recordingLabels = [];
    
    for (let i = 0; i < 300; i++) {
        const t = i * 0.1;
        recordingLabels.push(t.toFixed(1));
        
        // åŸå§‹pulse
        const pulse = Math.exp(-Math.pow((t - 10), 2) / 8) * Math.cos(2 * Math.PI * t);
        recordingData1.push(pulse);
        
        // å¤ªçŸ­çš„è¨˜éŒ„
        const shortRecord = (t < 15) ? pulse : 0;
        recordingData2.push(shortRecord);
        
        // é©ç•¶çš„è¨˜éŒ„
        const goodRecord = (t < 25) ? pulse : 0;
        recordingData3.push(goodRecord);
    }

    new Chart(recordingCtx, {
        type: 'line',
        data: {
            labels: recordingLabels,
            datasets: [{
                label: 'åŸå§‹Pulse',
                data: recordingData1,
                borderColor: 'rgb(54, 162, 235)',
                borderWidth: 2,
                pointRadius: 0
            }, {
                label: 'è¨˜éŒ„å¤ªçŸ­ âŒ',
                data: recordingData2,
                borderColor: 'rgb(255, 99, 132)',
                borderWidth: 2,
                pointRadius: 0,
                borderDash: [5, 5]
            }, {
                label: 'è¨˜éŒ„é©ç•¶ âœ…',
                data: recordingData3,
                borderColor: 'rgb(75, 192, 192)',
                borderWidth: 2,
                pointRadius: 0,
                borderDash: [10, 5]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: { title: { display: true, text: 'æ™‚é–“' }},
                y: { title: { display: true, text: 'æŒ¯å¹…' }}
            }
        }
    });

    // è¤‡é›œåº¦æ¯”è¼ƒåœ–
    const complexityCtx = document.getElementById('complexityChart').getContext('2d');
    const nValues = [64, 128, 256, 512, 1024, 2048, 4096];
    const dftOps = nValues.map(n => n * n);
    const fftOps = nValues.map(n => n * Math.log2(n));

    new Chart(complexityCtx, {
        type: 'line',
        data: {
            labels: nValues,
            datasets: [{
                label: 'DFT: O(NÂ²)',
                data: dftOps,
                borderColor: 'rgb(255, 99, 132)',
                borderWidth: 2,
                pointRadius: 4
            }, {
                label: 'FFT: O(N log N)',
                data: fftOps,
                borderColor: 'rgb(75, 192, 192)',
                borderWidth: 2,
                pointRadius: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: { 
                    title: { display: true, text: 'æ•¸æ“šé»æ•¸ N' },
                    type: 'logarithmic'
                },
                y: { 
                    title: { display: true, text: 'é‹ç®—æ¬¡æ•¸' },
                    type: 'logarithmic'
                }
            }
        }
    });
</script>
```

</body>
</html>