<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FDTDåƒæ•¸é—œä¿‚åœ–åƒåŒ–èªªæ˜</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .chart-container {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .parameter-box {
            background: #e8f4f8;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #2196F3;
            border-radius: 5px;
            font-family: monospace;
            font-size: 14px;
        }
        .calculation-box {
            background: #fff3cd;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #ffc107;
            border-radius: 5px;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .full-width {
            grid-column: 1 / -1;
        }
        h2 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .highlight {
            background: #ffeb3b;
            padding: 2px 4px;
            border-radius: 3px;
        }
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>FDTDåƒæ•¸é—œä¿‚åœ–åƒåŒ–èªªæ˜</h1>
        
        <h2>1. ç‰©ç†åƒæ•¸ â†’ æ¨¡æ“¬åƒæ•¸çš„è½‰æ›</h2>
        
        <div class="grid">
            <div>
                <div class="parameter-box">
                    <strong>ç‰©ç†åƒæ•¸ (SIå–®ä½)</strong><br>
                    wavelength = 1550e-9 m<br>
                    frequency = 3e8 / 1550e-9 = 1.94e14 Hz<br>
                    period = 1 / frequency = 5.16e-15 s<br>
                    omega = 2Ï€ Ã— frequency = 1.22e15 rad/s
                </div>
                
                <div class="calculation-box">
                    <strong>å–®ä½è½‰æ›é—œéµ</strong><br>
                    grid.time_step â‰ˆ 4.66e-17 s<br>
                    é€™æ˜¯é€£æ¥ç‰©ç†èˆ‡æ¨¡æ“¬çš„æ©‹æ¢ï¼
                </div>
            </div>
            
            <div>
                <div class="parameter-box">
                    <strong>æ¨¡æ“¬åƒæ•¸ (timestepå–®ä½)</strong><br>
                    period_sim = period / time_step = 110.7 timesteps<br>
                    frequency_sim = 1 / period_sim = 0.009 (1/timestep)<br>
                    omega_sim = 2Ï€ / period_sim = 0.057 rad/timestep
                </div>
                
                <div class="calculation-box">
                    <strong>ç‰©ç†æ„ç¾©</strong><br>
                    110.7 timesteps = ä¸€å€‹å…‰å­¸é€±æœŸ<br>
                    æ¯å€‹timestepç›¸ä½å¢åŠ  0.057 rad
                </div>
            </div>
        </div>

        <h2>2. è¼‰æ³¢æŒ¯ç›ªå¯è¦–åŒ–</h2>
        
        <div class="chart-container">
            <h3>ç‰©ç†æ™‚é–“ vs æ¨¡æ“¬æ™‚é–“çš„è¼‰æ³¢</h3>
            <canvas id="carrierComparison" width="800" height="400"></canvas>
            <div class="calculation-box">
                <strong>è§€å¯Ÿé‡é»</strong>ï¼šå…©æ¢æ›²ç·šå®Œå…¨é‡åˆï¼é€™è­‰æ˜å–®ä½è½‰æ›æ­£ç¢ºã€‚<br>
                <span class="highlight">omega_sim Ã— timestep = omega Ã— time</span>
            </div>
        </div>

        <h2>3. Hanningåƒæ•¸è¨­è¨ˆ</h2>
        
        <div class="grid">
            <div class="chart-container">
                <h3>hanning_dt_simçš„ä½œç”¨</h3>
                <canvas id="hanningDt" width="400" height="300"></canvas>
                <div class="parameter-box">
                    hanning_dt_sim = 0.5 / frequency_sim<br>
                    = 0.5 / 0.009 = 55.35
                </div>
            </div>
            
            <div class="chart-container">
                <h3>è„ˆè¡æŒçºŒæ™‚é–“è¨ˆç®—</h3>
                <canvas id="pulseDuration" width="400" height="300"></canvas>
                <div class="parameter-box">
                    t1 = 2Ï€ / (frequency_sim Ã— hanning_dt_sim / cycle)<br>
                    = 2Ï€ / (0.009 Ã— 55.35 / 5) = 667 timesteps
                </div>
            </div>
        </div>

        <h2>4. Hanningå‡½æ•¸å®Œæ•´åˆ†æ</h2>
        
        <div class="chart-container full-width">
            <h3>hanning(f, t, n) çš„ä¸‰å€‹çµ„æˆéƒ¨åˆ†</h3>
            <canvas id="hanningComponents" width="1000" height="500"></canvas>
            <div class="parameter-box">
                def hanning(f, t, n):<br>
                &nbsp;&nbsp;&nbsp;&nbsp;envelope = (1/2) Ã— (1 - cos(f Ã— t / n))  # åŒ…çµ¡éƒ¨åˆ†<br>
                &nbsp;&nbsp;&nbsp;&nbsp;carrier = sin(f Ã— t)  # è¼‰æ³¢éƒ¨åˆ†<br>
                &nbsp;&nbsp;&nbsp;&nbsp;return envelope Ã— carrier
            </div>
        </div>

        <h2>5. å®Œæ•´çš„è„ˆè¡ç”Ÿæˆéç¨‹</h2>
        
        <div class="chart-container full-width">
            <h3>æ‚¨çš„ComplexPlaneWaveä¸­çš„è„ˆè¡</h3>
            <canvas id="complexPulse" width="1000" height="400"></canvas>
            <div class="calculation-box">
                <strong>æ³¨æ„</strong>ï¼šæ‚¨çš„å¯¦ç¾ä¸­ï¼Œhanningå‡½æ•¸æä¾›çš„è¼‰æ³¢æœƒèˆ‡ä¸»è¼‰æ³¢<span class="highlight">ç›¸äº’å¹²æ“¾</span>ï¼<br>
                ä¸»è¼‰æ³¢ï¼šexp(j Ã— omega_sim Ã— q)<br>
                Hanningè¼‰æ³¢ï¼šsin(frequency_sim Ã— q Ã— hanning_dt_sim)<br>
                å…©è€…é »ç‡ä¸åŒï¼Œæœƒç”¢ç”Ÿæ‹é »ç¾è±¡ï¼
            </div>
        </div>

        <h2>6. å•é¡Œè¨ºæ–·</h2>
        
        <div class="calculation-box">
            <h3>ğŸ” ç‚ºä»€éº¼æ‚¨çš„è„ˆè¡çœ‹èµ·ä¾†å¥‡æ€ªï¼Ÿ</h3>
            <p><strong>é »ç‡è¡çª</strong>ï¼š</p>
            <ul>
                <li>ä¸»è¼‰æ³¢é »ç‡ï¼šomega_sim = 0.057 rad/timestep</li>
                <li>Hanningè¼‰æ³¢é »ç‡ï¼šfrequency_sim Ã— hanning_dt_sim = 0.009 Ã— 55.35 = 0.498 rad/timestep</li>
                <li>æ¯”ä¾‹ï¼š0.498 / 0.057 â‰ˆ 8.7å€ï¼</li>
            </ul>
            
            <p><strong>è§£æ±ºæ–¹æ¡ˆ</strong>ï¼š</p>
            <ol>
                <li><strong>åªç”¨åŒ…çµ¡</strong>ï¼šä¿®æ”¹hanningå‡½æ•¸ï¼Œåªè¿”å›åŒ…çµ¡éƒ¨åˆ†</li>
                <li><strong>çµ±ä¸€è¼‰æ³¢</strong>ï¼šè®“hanningçš„è¼‰æ³¢é »ç‡ç­‰æ–¼omega_sim</li>
                <li><strong>ç°¡åŒ–è¨­è¨ˆ</strong>ï¼šç”¨ç°¡å–®çš„çª—å‡½æ•¸ä»£æ›¿hanning</li>
            </ol>
        </div>
    </div>

    <script>
        // è¨­å®šå¯¦éš›çš„æ•¸å€¼åƒæ•¸
        const wavelength = 1550e-9;
        const c = 3e8;
        const frequency_phys = c / wavelength;  // 1.94e14 Hz
        const period_phys = 1 / frequency_phys; // 5.16e-15 s
        const omega_phys = 2 * Math.PI * frequency_phys; // 1.22e15 rad/s
        
        const time_step = 4.66e-17; // s
        const period_sim = period_phys / time_step; // 110.7 timesteps
        const frequency_sim = 1 / period_sim; // 0.009 1/timestep
        const omega_sim = 2 * Math.PI / period_sim; // 0.057 rad/timestep
        
        const hanning_dt_sim = 0.5 / frequency_sim; // 55.35
        const cycle = 5;
        const t1 = 2 * Math.PI / (frequency_sim * hanning_dt_sim / cycle); // 667 timesteps
        
        // ç”Ÿæˆæ™‚é–“è»¸
        const timesteps = 200;
        const q_array = Array.from({length: timesteps}, (_, i) => i);
        const t_array = q_array.map(q => q * time_step);
        
        // åœ–è¡¨é…ç½®
        const chartConfig = {
            type: 'line',
            options: {
                responsive: true,
                elements: {
                    point: { radius: 0 }
                },
                plugins: {
                    legend: { display: true }
                },
                scales: {
                    x: { title: { display: true } },
                    y: { title: { display: true } }
                }
            }
        };
        
        // 1. è¼‰æ³¢æ¯”è¼ƒ
        const carrier_phys = q_array.map(q => Math.sin(omega_phys * q * time_step));
        const carrier_sim = q_array.map(q => Math.sin(omega_sim * q));
        
        new Chart(document.getElementById('carrierComparison'), {
            ...chartConfig,
            data: {
                labels: q_array,
                datasets: [
                    {
                        label: 'ç‰©ç†è¼‰æ³¢ï¼šsin(omega Ã— t)',
                        data: carrier_phys,
                        borderColor: '#e74c3c',
                        borderWidth: 2,
                        fill: false
                    },
                    {
                        label: 'æ¨¡æ“¬è¼‰æ³¢ï¼šsin(omega_sim Ã— q)',
                        data: carrier_sim,
                        borderColor: '#3498db',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        fill: false
                    }
                ]
            },
            options: {
                ...chartConfig.options,
                scales: {
                    x: { title: { display: true, text: 'Timesteps (q)' } },
                    y: { title: { display: true, text: 'Amplitude' } }
                }
            }
        });
        
        // 2. hanning_dt_simæ•ˆæœ
        const hanning_arg = q_array.map(q => q * hanning_dt_sim);
        const hanning_envelope = hanning_arg.map(arg => 0.5 * (1 - Math.cos(frequency_sim * arg / cycle)));
        
        new Chart(document.getElementById('hanningDt'), {
            ...chartConfig,
            data: {
                labels: q_array,
                datasets: [{
                    label: 'q Ã— hanning_dt_sim',
                    data: hanning_arg,
                    borderColor: '#9b59b6',
                    borderWidth: 2,
                    fill: false
                }]
            },
            options: {
                ...chartConfig.options,
                scales: {
                    x: { title: { display: true, text: 'Timesteps (q)' } },
                    y: { title: { display: true, text: 'Value' } }
                }
            }
        });
        
        // 3. è„ˆè¡æŒçºŒæ™‚é–“
        const pulse_indicator = q_array.map(q => q < t1 ? 1 : 0);
        
        new Chart(document.getElementById('pulseDuration'), {
            ...chartConfig,
            data: {
                labels: q_array,
                datasets: [{
                    label: `è„ˆè¡çª— (æŒçºŒ ${Math.round(t1)} timesteps)`,
                    data: pulse_indicator,
                    borderColor: '#2ecc71',
                    backgroundColor: 'rgba(46, 204, 113, 0.2)',
                    borderWidth: 2,
                    fill: true
                }]
            },
            options: {
                ...chartConfig.options,
                scales: {
                    x: { title: { display: true, text: 'Timesteps (q)' } },
                    y: { title: { display: true, text: 'On/Off' } }
                }
            }
        });
        
        // 4. Hanningå‡½æ•¸çµ„ä»¶åˆ†æ
        const hanning_envelope_full = q_array.map(q => {
            const t = q * hanning_dt_sim;
            return 0.5 * (1 - Math.cos(frequency_sim * t / cycle));
        });
        
        const hanning_carrier = q_array.map(q => {
            const t = q * hanning_dt_sim;
            return Math.sin(frequency_sim * t);
        });
        
        const hanning_full = q_array.map(q => {
            const t = q * hanning_dt_sim;
            const envelope = 0.5 * (1 - Math.cos(frequency_sim * t / cycle));
            const carrier = Math.sin(frequency_sim * t);
            return envelope * carrier;
        });
        
        new Chart(document.getElementById('hanningComponents'), {
            ...chartConfig,
            data: {
                labels: q_array,
                datasets: [
                    {
                        label: 'åŒ…çµ¡ï¼š(1 - cos(fÃ—t/n))',
                        data: hanning_envelope_full,
                        borderColor: '#f39c12',
                        borderWidth: 3,
                        fill: false
                    },
                    {
                        label: 'è¼‰æ³¢ï¼šsin(fÃ—t)',
                        data: hanning_carrier.map(x => x * 0.3), // ç¸®æ”¾ä»¥ä¾¿è§€çœ‹
                        borderColor: '#e74c3c',
                        borderWidth: 1,
                        borderDash: [3, 3],
                        fill: false
                    },
                    {
                        label: 'Hanningçµæœï¼šåŒ…çµ¡ Ã— è¼‰æ³¢',
                        data: hanning_full,
                        borderColor: '#8e44ad',
                        borderWidth: 2,
                        fill: false
                    }
                ]
            },
            options: {
                ...chartConfig.options,
                scales: {
                    x: { title: { display: true, text: 'Timesteps (q)' } },
                    y: { title: { display: true, text: 'Amplitude' } }
                }
            }
        });
        
        // 5. è¤‡æ•¸è„ˆè¡å•é¡Œå±•ç¤º
        const main_carrier = q_array.map(q => Math.sin(omega_sim * q));
        const hanning_with_envelope = q_array.map(q => {
            if (q < t1) {
                const t = q * hanning_dt_sim;
                const envelope = 0.5 * (1 - Math.cos(frequency_sim * t / cycle));
                const carrier = Math.sin(frequency_sim * t);
                return envelope * carrier;
            }
            return 0;
        });
        
        const combined_problematic = q_array.map((q, i) => {
            return main_carrier[i] * (1 + hanning_with_envelope[i]); // å±•ç¤ºå¹²æ“¾æ•ˆæœ
        });
        
        new Chart(document.getElementById('complexPulse'), {
            ...chartConfig,
            data: {
                labels: q_array,
                datasets: [
                    {
                        label: 'ä¸»è¼‰æ³¢ï¼šsin(omega_sim Ã— q)',
                        data: main_carrier.map(x => x * 0.3),
                        borderColor: '#3498db',
                        borderWidth: 1,
                        borderDash: [5, 5],
                        fill: false
                    },
                    {
                        label: 'Hanningè¼¸å‡º',
                        data: hanning_with_envelope,
                        borderColor: '#e67e22',
                        borderWidth: 2,
                        fill: false
                    },
                    {
                        label: 'çµ„åˆçµæœï¼ˆæœ‰å•é¡Œï¼‰',
                        data: combined_problematic,
                        borderColor: '#e74c3c',
                        borderWidth: 3,
                        fill: false
                    }
                ]
            },
            options: {
                ...chartConfig.options,
                scales: {
                    x: { title: { display: true, text: 'Timesteps (q)' } },
                    y: { title: { display: true, text: 'Field Amplitude' } }
                }
            }
        });
    </script>
</body>
</html>
